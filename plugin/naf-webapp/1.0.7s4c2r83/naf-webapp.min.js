// Copyright 1999-2012 SeaChange International
// All Rights Reserved.
NAF.conf={debug:1,traxisIp:"217.149.130.196",traxisid:"device1",chanlocsrc:"mediaware",traxisidprefix:"CpeId",numhours:4,refreshInterval:10,refreshInterval0:1,reminderTime:5,pretune:!0,previouspretunes:0,followingpretunes:1,codcatalog:0,searchCacheSize:10,maxPinAttempts:3,pinRetryInterval:300,wakeuptime:120,prerecordwakeuptime:3,teletextHandling:!1,langTimeOut:500,mediawareip:"",chanUpDownKeyHandling:!1,startChannel:"CNN",initChannel:"lastViewed",lockedChannels:[],radioChannels:[5],profileAgeRating:21,
enable000reload:!1,canned:!1,cannedPath:"../data/217.149.130.199",useNewRecordingManager:!0,useUnifiedMapPlayer:!0,catchUpCategory:"crid:~~2F~~2Fschange.com~~2F4e3c5465-a7dc-4e7b-b94e-fd2b9eb6e500",catchUpChannel:0,genreData:JSON.stringify({genres:[{code:"1",name:"movie",subgenres:[]},{code:"2",name:"news",subgenres:[]},{code:"3",name:"show",subgenres:[]},{code:"4",name:"sports",subgenres:[]},{code:"5",name:"children's",subgenres:[]},{code:"6",name:"music",subgenres:[]},{code:"7",name:"arts",subgenres:[]},
{code:"8",name:"social",subgenres:[]},{code:"9",name:"education",subgenres:[]},{code:"10",name:"leisure",subgenres:[]},{code:"11",name:"special",subgenres:[]},{code:"12",name:"entertainment",subgenres:[]},{code:"13",name:"crime",subgenres:[]},{code:"14",name:"series",subgenres:[]},{code:"15",name:"adult",subgenres:[]}]}),applications:[{id:"id1",name:"MetrologicalAppStore",shortSynopsis:"The Metrological App Store",isAdult:!1,isViewable:!0,isEntitled:!0,url:"scripts/lib/seachange/examples/MasterApp/webApp.html",
type:"store"}]};function nafCleanupConf(){NAF.conf.canned&&(NAF.conf.traxisid="");if("undefined"!==typeof window){for(var d=[],h,k=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),e=0;e<k.length;e++)h=k[e].split("="),d.push(h[0]),d[h[0]]=h[1];for(e=0;e<d.length;e++)NAF.conf.hasOwnProperty(d[e])&&(h=d[d[e]],isNaN(h)?NAF.conf[d[e]]="true"===h?!0:"false"===h?!1:h:NAF.conf[d[e]]=parseFloat(h,10))}}nafCleanupConf();nafCleanupConf=null;
NAF.utils={convertJSONDateToJSDate:function(d){var h;return"string"===typeof d&&(h=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(d))?new Date(Date.UTC(+h[1],+h[2]-1,+h[3],+h[4],+h[5],+h[6])):h},convertLocalJSONDateToLocalJSDate:function(d){var h;return"string"===typeof d&&(h=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(d))?new Date(+h[1],+h[2]-1,+h[3],+h[4],+h[5],+h[6]):h},convertJSONDateToMins:function(d){d=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(d);
return(new Date(Date.UTC(+d[1],+d[2]-1,+d[3],+d[4],+d[5],+d[6]))).getTime()/6E4},convertJSONDateToJSDateCanned:function(d){var h,k=new Date;return"string"===typeof d&&(h=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(d))?new Date(Date.UTC(+k.getUTCFullYear(),+k.getUTCMonth(),+k.getUTCDate(),+h[4],+h[5],+h[6])):h},convertJSDateToJSONDate:function(d){var h=d.getUTCMonth()+1;10>h&&(h="0"+h);var k=d.getUTCDate();10>k&&(k="0"+k);var e=d.getUTCHours();10>e&&(e="0"+e);var b=d.getUTCMinutes();
10>b&&(b="0"+b);return d.getUTCFullYear()+"-"+h+"-"+k+"T"+e+":"+b+":00Z"},clearTimer:function(d){d&&clearTimeout(d)},encodeXML:function(d){return d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")},throttle:function(d,h){function k(){e=null}var e,b,g;return function(){b=this;g=arguments;e||(result=d.apply(b,g),e=setTimeout(k,h))}},decimalToBinary:function(d,h){for(var k=
d,e=0,b=[];0<k;)e=k%2,k=Math.floor(k/2),b.unshift(e);k=h-b.length;if(0<k)for(e=0;e<k;e++)b.unshift(0);else if(0>k)return null;return b},Log:function(){function d(a,c){if(h&&a.rank<=p.rank){console.log((new Date).toISOString()+" "+a.text+" "+k+" "+c[0]);for(var b=1;b<c.length;b++)console.log(c[b])}}var h=!1,k="",e={text:" FATAL ",rank:0},b={text:" ERROR ",rank:1},g={text:" WARN  ",rank:2},q={text:" DEBUG ",rank:3},f={text:" TRACE ",rank:4},s={text:" INFO  ",rank:5},p=f;this.trace=function(){d(f,arguments)};
this.debug=function(){d(q,arguments)};this.info=function(){d(s,arguments)};this.warn=function(){d(g,arguments)};this.error=function(){d(b,arguments)};this.fatal=function(){d(e,arguments)};this.enable=function(){h=!0};this.disable=function(){h=!1};this.setAppName=function(a){k=a};this.setLevel=function(){return{fatal:function(){p=e},error:function(){p=b},warn:function(){p=g},debug:function(){p=q},trace:function(){p=f},info:function(){p=s}}}()}};
NAF.Map=function(d,h){function k(){var a=new XMLHttpRequest,c={};c.method=arguments[0];c.id=q++;c.jsonrpc=f;for(var e={},l=1;l<arguments.length;l+=2)e[arguments[l]]=arguments[l+1];c.params=e;c=JSON.stringify(c);e="/ajax?"+encodeURI(c);"undefined"!=typeof g&&""!=g&&(e="http://"+g+e);b.debug("MAP-REQ: "+c);a.open("GET",e,!1);a.setRequestHeader("Content-Type","application/json;charset=UTF-8");a.send(null);var m;try{m=JSON.parse(a.responseText)}catch(d){m={error:d,result:-1}}m.error?b.error("MAP-ERR: code="+
m.error.code+" message="+m.error.message):b.debug("MAP-RES: status="+a.status+" response="+a.responseText.substr(0,80));return m.result}function e(a,c,e){var l=c.callbackParams;delete c.callbackParams;var m=new XMLHttpRequest,d={};d.method=a;d.id=q++;d.jsonrpc=f;d.params=c;a=JSON.stringify(d);c="/ajax?"+encodeURI(a);"undefined"!=typeof g&&""!=g&&(c="http://"+g+c);b.debug("MAP-ASYNC-REQ: "+a);m.open("GET",c,!0);m.setRequestHeader("Content-Type","application/json;charset=UTF-8");m.onreadystatechange=
function(){if(4===m.readyState){var a;try{200==m.status?b.debug("MAP-ASYNC-RESPONSE: SUCCESS "+m.responseText):b.debug("MAP-ASYNC-RESPONSE: ERROR "+m.responseText),a=JSON.parse(m.responseText)}catch(c){a={error:c,result:-1}}a.error&&b.error("MAP-ERR: code="+a.error.code+" message="+a.error.message);e&&e(a.result,l)}};m.send(null)}var b=d.log,g=h,q=1,f="2.0",s,p=this;b.warn("***DEPRECATED key map in NAF.Map, moving to NAF.Model.KeyMap****\n");this.VK_EXIT=3;this.VK_BACK_SPACE=8;this.VK_ENTER=this.VK_OK=
13;this.VK_KEYBOARD=16;this.VK_ACCEPT=30;this.VK_SPACE=32;this.VK_PAGE_UP=33;this.VK_PAGE_DOWN=34;this.VK_HOME=36;this.VK_LEFT=37;this.VK_UP=38;this.VK_RIGHT=39;this.VK_DOWN=40;this.VK_0=48;this.VK_1=49;this.VK_2=50;this.VK_3=51;this.VK_4=52;this.VK_5=53;this.VK_6=54;this.VK_7=55;this.VK_8=56;this.VK_9=57;this.VK_A=65;this.VK_B=66;this.VK_C=67;this.VK_D=68;this.VK_E=69;this.VK_F=70;this.VK_G=71;this.VK_H=72;this.VK_I=73;this.VK_J=74;this.VK_K=75;this.VK_L=76;this.VK_M=77;this.VK_N=78;this.VK_O=79;
this.VK_P=80;this.VK_Q=81;this.VK_R=82;this.VK_S=83;this.VK_T=84;this.VK_U=85;this.VK_V=86;this.VK_W=87;this.VK_X=88;this.VK_Y=89;this.VK_Z=90;this.VK_RED=403;this.VK_GREEN=404;this.VK_BLUE=406;this.VK_YELLOW=405;this.VK_DELETE=127;this.VK_HELP=156;this.VK_POWER=409;this.VK_CHANNEL_UP=427;this.VK_CHANNEL_DOWN=428;this.VK_VOLUME_UP=447;this.VK_VOLUME_DOWN=448;this.VK_MUTE=449;this.VK_INFO=457;this.VK_GUIDE=458;this.VK_BACK=461;this.VK_MENU=462;this.VK_PAUSE=19;this.VK_REW=412;this.VK_STOP=413;this.VK_PLAY=
415;this.VK_REC=416;this.VK_FF=417;this.VK_REW_SKIP=424;this.VK_FWD_SKIP=425;this.VK_FAV=433;this.VK_TELETEXT=459;this.VK_SUBTITLE=460;this.SetAsyncEventHandlers=function(a,c,e){s=new EventSource("/server-sent-events");s.onopen=a;s.onmessage=function(a){a:{var m;try{m=JSON.parse(a.data)}catch(g){b.error("server-sent event parsing failed, event handler not invoked."+g);e("Invalid server-sent event");break a}"undefined"!==typeof m.method?c(m):(b.error("server-sent event is not a valid MW event, event handler not invoked."),
e("Invalid server-sent event"))}};s.onerror=function(b){var m;switch(b.target.readyState){case EventSource.CONNECTING:m="Eventsource reconnecting.";break;case EventSource.CLOSED:m="Eventsource closed. Creating a new one.",setTimeout(function(){p.SetAsyncEventHandlers(a,c,e)},1E4)}e(m)}};this.VidSetAnimationParameters=function(a,c,b,l,m,g){e("VidSetAnimationParameters",{windowId:a,bAnimate:c,duration:b,speed:speed,fps:m},g)};this.VidPretune=function(a,c,b){e("VidPreTune",{windowId:a,LocatorArray:c},
b)};this.VidStopPretune=function(a,c,b){e("VidStopPreTune",{windowId:a},b)};this.VidGetCurChan=function(a){e("VidGetCurChan",{},a)};this.VidGetLastChan=function(a){e("VidGetLastChan",{},a)};this.VidGetStartChan=function(){return null};this.VidDetune=function(a){e("VidDetune",{},a)};this.VidGetChanCount=function(a){e("VidGetChanCount",{},a)};this.VidGetChannelList=function(a,c){e("VidGetChannelList",{platform:a},c)};this.VidSetVideoWinSize=function(a,c,b,l,m,g){e("VidSetVideoWinSize",{x:a,y:c,w:b,
h:l,bPIP:m},g)};this.VidEnableCC=function(a,c){e("VidSetCloseCap",{enable:a},c)};this.VidGetAvailableAudioLang=function(a){e("GetAvailableAudioLanguages",{},a)};this.VidSetPrefAudioLang=function(a,c,b,l){var m={};m.language=a;m.type=c;m.callbackParams=l;e("SetAudioLanguagePreference",m,b)};this.VidGetPrefAudioLang=function(a){e("GetAudioLanguagePreference",{},a)};this.VidSetAudioLang=function(a,c,b){var l={};l.language=a;l.callbackParams=b;e("SetAudioLanguage",l,c)};this.VidGetAudioLang=function(a){e("GetAudioLanguage",
{},a)};this.VidSetResolution=function(a,c,b){e("VidSetResolution",{port:a,resolution:c},b)};this.VidStopPIP=function(a){e("VidStopPIP",{},a)};this.VidMakePipPrimary=function(a){e("VidMakePipPrimary",{},a)};this.VidGetAvailableSubtitleLang=function(a){e("GetAvailableSubtitleLanguages",{},a)};this.VidSetPrefSubtitleLang=function(a,c,b,l){var m={};m.language=a;m.type=c;m.callbackParams=l;e("SetSubtitleLanguagePreference",m,b)};this.VidGetPrefSubtitleLang=function(a){e("GetSubtitleLanguagePreference",
{},a)};this.VidGetSubtitleAvailability=function(a){e("GetSubtitleAvailability",{},a)};this.VidEnableSubtitle=function(a,c){var b={};b.enable=a;e("EnableSubtitle",b,c)};this.VidSetSubtitleLang=function(a,c,b){var l={};l.language=a;l.callbackParams=b;e("SetSubtitleLanguage",l,c)};this.VidGetSubtitleLang=function(a){e("GetSubtitleLanguage",{},a)};this.IsSubtitleEnabled=function(a){e("IsSubtitleEnabled",{},a)};this.VidSetPrefTeletextLang=function(a,c){return k("SetTeletextLanguage","language",a,"type",
c)};this.VidGetPrefTeletextLang=function(){};this.IsTeletextEnabled=function(a){e("IsTeletextEnabled",{},a)};this.EnableTeletext=function(a,c){e("EnableTeletext",{enable:a},c)};this.IsTeletextAvailable=function(a){e("IsTeletextAvailable",{},a)};this.VidSetTeletextLang=function(a,c){};this.VidGetTeletextLang=function(){};this.VidSpeakerMute=function(a,c){e("VidSpeakerMute",{flag:a},c)};this.VidDisplayVideoOn=function(a,c){e("VidDisplayVideoOn",{flag:a},c)};this.DlnaSetDeviceName=function(a,c){return k("MapDLNASetDeviceName",
"name",a,"type",c)};this.DlnaGetDeviceName=function(a){return k("MapDLNAGetDeviceName","type",a)};this.MapDLNAGetActiveDevices=function(a){return k("MapDLNAGetActiveDevices","type",a)};this.MapDLNAGetContainer=function(a,c,b,l,m,g,n,t){if(t)e("MapDLNAGetContainer",{id:a,containerId:c,containerType:b,filter:l,startAt:m,requestedCount:g,sort:n},t);else return k("MapDLNAGetContainer","id",a,"containerId",c,"containerType",b,"filter",l,"startAt",m,"requestedCount",g,"sort",n)};this.MapPlayer=function(a,
c,b,l,m,g,n,t,f,d,q){var k={};k.type=m;k.x=g;k.y=n;k.width=t;k.height=f;m={};q&&(m.callbackParams=q);m.ver="1.0";m.url=a;m.block=c;m.rate=b;m.playPos=l;m.window=k;e("MapPlayer",m,d)};this.MapPlayerRTSPVod=function(a,c,b,l,m,g,n,t,f,q){var d={};d.type=m;d.x=g;d.y=n;d.width=t;d.height=f;m={ver:"1.0"};m.id=a;m.block=c;m.rate=b;m.playPos=l;m.window=d;e("MapPlayer",m,q)};this.MapPlayerStop=function(a,c,b,l,m,g){var n={};n.type=a;n.x=c;n.y=b;n.width=l;n.height=m;e("MapPlayer",{ver:"1.0",window:n},g)};this.MapPlayerSkip=
function(a,c,b,l,g,d,n,f,q){var k={};k.type=l;k.x=g;k.y=d;k.width=n;k.height=f;e("MapPlayer",{ver:"1.0",url:a,rate:c,playPos:b,window:k},q)};this.DvrSync=function(){return k("PvrSync")};this.DvrRecord=function(a,c,b,e,g,d){return k("PvrSchedRecording","locator",a,"channelId",c,"duration",b,"title",e,"description",g,"start",d)};this.DvrRecordEvent=function(a){console.log("DvrRecordEvent: "+a);return k("PvrSchedRecording","eventCrid",a)};this.DvrRecordSeries=function(a){console.log("DvrRecordSeries: "+
a);return k("PvrSchedRecording","seriesCrid",a)};this.DvrUpdateRecord=function(a,c,b){return null==c?(console.log("DvrUpdateRecord(): duration is null!!!"),null==b&&console.log("DvrUpdateRecord(): nothing to update!!!"),k("PvrUpdateRecording","recordingId",a,"start",b)):null==b?(console.log("DvrUpdateRecord(): startTime is null!!!"),k("PvrUpdateRecording","recordingId",a,"duration",c)):k("PvrUpdateRecording","recordingId",a,"duration",c,"start",b)};this.DvrAssetList=function(a){e("PvrListRecording",
{},a)};this.DvrListRequests=function(a){if(a)e("PvrListRequests",{},a);else return k("PvrListRequests")};this.DvrListOperations=function(a){if(a)e("PvrListOperations",{},a);else return k("PvrListOperations")};this.DvrListRecordings=function(a){if(a)e("PvrListRecordings",{},a);else return k("PvrListRecordings")};this.DvrPause=function(a){e("PvrPlayTrick",{speed:0},a)};this.DvrResume=function(a){e("PvrPlayTrick",{speed:100},a)};this.DvrFastForward=function(a,c){e("PvrPlayTrick",{speed:a},c)};this.DvrRewind=
function(a,c){e("PvrPlayTrick",{speed:-a},c)};this.DvrOffset=function(a,c){e("PvrPlaySkip",{offset:a},c)};this.DvrDelete=function(a,c){e("PvrDeleteRecording",{locator:a},c)};this.DvrDeleteRequest=function(a,c){e("PvrDelete",{requestId:a},c)};this.DvrDeleteOperation=function(a,c){e("PvrDelete",{operationId:a},c)};this.DvrDeleteRecording=function(a,c){e("PvrDelete",{recordingId:a},c)};this.DvrStop=function(a){e("DvrStop",{},a)};this.PvrStop=function(a){e("PvrStop",{},a)};this.DvrStopRecording=function(a,
c){e("PvrStopRecording",{recordingId:a},c)};this.VodSessionOpen=function(a,c,b){e("VodSessionOpen",{assetId:a,vodType:c},b)};this.VodSessionClose=function(a){e("VodSessionClose",{},a)};this.VodPlay=function(a,c,b){e("VodPlay",{blocked:a,start:c},b)};this.VodPause=function(a){e("VodPause",{},a)};this.VodFastforward=function(a,c,b){e("VodFastforward",{numerator:a,denominator:c},b)};this.VodRewind=function(a,c,b){e("VodRewind",{numerator:a,denominator:c},b)};this.VodStop=function(a){e("VodStop",{},a)};
this.VodGet=function(a,c){e("VodGet",{name:a},c)};this.VodSet=function(a,c,b){e("VodSet",{name:a,value:c},b)};this.VodPlaySkip=function(a,c){e("VodPlaySkip",{offset:a},c)};this.VodResume=function(a){e("VodFastforward",{numerator:1,denominator:1},a)};this.ConfigGet=function(a,c){e("ConfigGet",{name:a},c)};this.ConfigSet=function(a,c){return k("ConfigSet","name",a,"value",c)};this.GetMWConfig=function(a,c,b){e("GetMWConfig",{section:a,key:c},b)};this.EmulateRemoteKey=function(a){return k("EmulateRemoteKey",
"KeyCode",a)};this.VerifyPin=function(a,c,b,l,g){var d={},d={profile:a,type:c,pin:b};d.callbackParams=g;e("VerifyPin",d,l)};this.ResetPin=function(a,c,b,l,g,d){var n={},n={profile:a,type:c,masterpin:b,newpin:l};n.callbackParams=d;e("ResetPin",n,g)};this.GetPinState=function(a,c){e("GetPinState",{profile:a,type:c},callback)};this.ActivatePin=function(a,c,b,l){e("ActivatePin",{profile:a,type:c,masterpin:masterpin,activate:l},callback)};this.ProfileSetInitChan=function(a,c,b,l){var g={};l&&(g.callbackParams=
l);g.profileId=a;-1!=a.indexOf("MasterProfile")&&(g.keyword="master");g.Settings={};g.Settings.initChannel=c;e("WriteProfile",g,b)};this.ProfileGetInitChan=function(a,c,b){var g={};b&&(g.callbackParams=b);g.profileId=a;g.Settings=["initChannel"];e("ReadProfile",g,c)};this.ProfileSetAgeRating=function(a,c,b,g){c=c?c:1001;var d={};g&&(d.callbackParams=g);d.profileId=a;-1!=a.indexOf("MasterProfile")&&(d.keyword="master");d.Settings={};d.Settings.ageRating=c;e("WriteProfile",d,b)};this.ProfileGetAgeRating=
function(a,c,b){var g={};b&&(g.callbackParams=b);g.profileId=a;g.Settings=["ageRating"];e("ReadProfile",g,c)};this.SetStandbyMode=function(a,c,b,g){e("SetStandbyMode",{mode:a,time:c,callbackParams:g},b)};this.AcknowledgePowerManagerEvent=function(a){e("AcknowledgePowerManagerEvent",{},a)};this.PesGetAllEvents=function(a,c){e("GetAllEvents",{filter:a},c)};this.PesGetChannelsWithEvent=function(a,c,b,g){e("GetChannelsWithEvent",{ChanFilter:a,ChanProps:c,EventFilter:b},g)};this.PesGetEventsByChanId=function(a,
c){return k("GetEventsByChanId","chanId",a,"filter",c)};this.PesGetEventsByLcn=function(a,c){return k("GetEventsByLcn","lcn",a,"filter",c)};this.PesGetPfEventsByChanId=function(a){return k("GetPfEventsByChanId","chanId",a)};this.PesGetPfEventsByLcn=function(a){return k("GetPfEventsByLcn","lcn",a)};this.MapGetOnlineMode=function(a){e("MapGetOnlineMode",{},a)};this.writePVRProfile=function(a,c,b,g){var d={};d.callbackParams=g;d.profileId=a;-1!=a.indexOf("MasterProfile")&&(d.keyword="master");d.Settings=
{};d.Settings.pvrSettings={};d.Settings.pvrSettings.frontPad=c.newFrontPad?c.newFrontPad:c.frontPad;d.Settings.pvrSettings.backPad=c.newBackPad?c.newBackPad:c.backPad;d.Settings.pvrSettings.seriesDomain=c.newSeriesDomain?c.newSeriesDomain:c.seriesDomain;d.Settings.pvrSettings.diskManagement=c.newSeriesDomain?c.newSeriesDomain:c.diskManagement;e("WriteProfile",d,b)};this.readPVRProfile=function(a,c,b){var g={};b&&(g.callbackParams=b);g.profileId=a;-1!=a.indexOf("MasterProfile")&&(g.keyword="master");
g.Settings=["pvrSettings"];e("ReadProfile",g,c)};this.writeViewSettingsProfile=function(a,c,b,g,d){var f={};f.callbackParams=d;f.profileId=a;-1!=a.indexOf("MasterProfile")&&(f.keyword="master");f.Settings={};f.Settings.viewSettings={};f.Settings.viewSettings.lang=c.newCode?c.newCode:c.code;f.Settings.viewSettings.langType=c.newType?c.newType:c.type;f.Settings.viewSettings.transparency=b.newTransparency?b.newTransparency:b.transparency;f.Settings.viewSettings.bannerTimeout=b.newBannerTimeout?b.newBannerTimeout:
b.bannerTimeout;f.Settings.viewSettings.epgStyle=b.newEpgStyle?b.newEpgStyle:b.epgStyle;f.Settings.viewSettings.epgSpan=b.newEpgSpan?b.newEpgSpan:b.epgSpan;f.Settings.viewSettings.assetsStyle=b.newAssetsStyle?b.newAssetsStyle:b.assetsStyle;f.Settings.viewSettings.settingsProtection=b.newSettingsProtection?b.newSettingsProtection:b.settingsProtection;e("WriteProfile",f,g)};this.readViewSettingsProfile=function(a,c,b){var g={};b&&(g.callbackParams=b);g.profileId=a;-1!=a.indexOf("MasterProfile")&&(g.keyword=
"master");g.Settings=["viewSettings"];e("ReadProfile",g,c)};this.writeOutputSettingsProfile=function(a,c,b,g){var d={};d.callbackParams=g;d.profileId=a;-1!=a.indexOf("MasterProfile")&&(d.keyword="master");d.Settings={};d.Settings.outputSettings={};d.Settings.outputSettings.primary=c.newPrimary?c.newPrimary:c.primary;d.Settings.outputSettings.hdmiResolution=c.hdmi.newResolution?c.hdmi.newResolution:c.hdmi.resolution;d.Settings.outputSettings.hdmiFormat=c.hdmi.newFormat?c.hdmi.newFormat:c.hdmi.format;
d.Settings.outputSettings.hdmiColor=c.hdmi.newColor?c.hdmi.newColor:c.hdmi.color;d.Settings.outputSettings.hdmiAudioEnable=c.hdmi.audio.newEnable?c.hdmi.audio.newEnable:c.hdmi.audio.enable;d.Settings.outputSettings.hdmiAudioDelay=c.hdmi.audio.newDelay?c.hdmi.audio.newDelay:c.hdmi.audio.delay;d.Settings.outputSettings.spdifEnable=c.spdif.newEnable?c.spdif.newEnable:c.spdif.enable;d.Settings.outputSettings.spdifDelay=c.spdif.newDelay?c.spdif.newDelay:c.spdif.delay;d.Settings.outputSettings.tvAspectRatio=
c.tv.newAspectRatio?c.tv.newAspectRatio:c.tv.aspectRatio;d.Settings.outputSettings.tvStart=c.tv.newStart?c.tv.newStart:c.tv.start;d.Settings.outputSettings.scartFormat=c.scart.newFormat?c.scart.newFormat:c.scart.format;d.Settings.outputSettings.scartColor=c.scart.newColor?c.scart.newColor:c.scart.color;d.Settings.outputSettings.scartEnable=c.scart.newEnable?c.scart.newEnable:c.scart.enable;d.Settings.outputSettings.audioFormat=c.audio.newFormat?c.audio.newFormat:c.audio.format;d.Settings.outputSettings.fpLuminosity=
c.frontPanel.newLuminosity?c.frontPanel.newLuminosity:c.frontPanel.luminosity;e("WriteProfile",d,b)};this.readOutputSettingsProfile=function(a,b,g){var d={};g&&(d.callbackParams=g);d.profileId=a;-1!=a.indexOf("MasterProfile")&&(d.keyword="master");d.Settings=["outputSettings"];e("ReadProfile",d,b)};this.VidGetTSBInfo=function(a){e("GetTSBInfo",{},a)};this.VidGetTSBEventInfo=function(a){e("GetTSBEventInfo",{},a)};this.SubscribePlayerPosition=function(a,b){e("MAPSubscribeEvent",{name:"MWPlayerPosition",
frequency:a},b)};this.UnsubscribePlayerPosition=function(a){e("MAPUnsubscribeEvent",{name:"MWPlayerPosition"},a)};this.SubscribeTSBEventInfo=function(a){e("MAPSubscribeEvent",{name:"TSBEventInfo"},a)};this.UnsubscribeTSBEventInfo=function(a){e("MAPUnsubscribeEvent",{name:"TSBEventInfo"},a)};this.AdjustUserAgeRating=function(a,b){e("AdjustUserAgeRating",{tempAgeRating:a},b)};this.RevertUserAgeRating=function(a){e("RevertUserAgeRating",{},a)};this.GetDiagnostics=function(a){e("GetDiagnostics",{},a)};
this.GetStandbyModeSettings=function(a){e("GetStandbyModeSettings",{},a)};this.SetStandbyModeSettings=function(a,b,g,d,f,q){e("SetStandbyModeSettings",{autoStandby:a,timeout:b,startTime:g,endTime:d,weekday:f},q)}};
pmrpc=self.pmrpc=function(){function d(){for(var a=[],b=0;36>b;b++)a[b]="0123456789ABCDEF"[Math.floor(16*Math.random())];a[14]="4";a[19]="89AB"[Math.floor(4*Math.random())];a[8]=a[13]=a[18]=a[23]="-";return a.join("")}function h(a,b){for(var c=a.whitelist,g=a.blacklist,n=!1,d=!1,e=0;e<c.length;++e)if(b.match(RegExp(c[e]))){n=!0;break}for(c=0;c<g.length;++c)if(b.match(RegExp(g[c]))){d=!0;break}return n&&!d}function k(a,b,c,g){if(!(c instanceof Array)){for(var n=a.toString(),d=n.substring(n.indexOf("(")+
1,n.indexOf(")")),d=""===d?[]:d.split(", "),n={},e=0;e<d.length;e++)n[d[e]]=e;var d=[],f;for(f in c)if("undefined"!==typeof n[f])d[n[f]]=c[f];else throw"No such param: "+f;c=d}"undefined"!==typeof g&&(c=c.concat(g));return a.apply(b,c)}function e(a,b,c){var n={jsonrpc:"2.0"};n.method=a;n.params=b;"undefined"!==typeof c&&(n.id=c);return n}function b(a,b,c){var n={};n.code=a;n.message=b;n.data=c;return n}function g(a,b,c){var n={jsonrpc:"2.0"};n.id=c;"undefined"===typeof a||null===a?n.result="undefined"===
b?null:b:n.error=a;return n}function q(a){if(a.publicProcedureName in v)return!1;n[a.publicProcedureName]={publicProcedureName:a.publicProcedureName,procedure:a.procedure,context:a.procedure.context,isAsync:"undefined"!==typeof a.isAsynchronous?a.isAsynchronous:!1,acl:"undefined"!==typeof a.acl?a.acl:{whitelist:["(.*)"],blacklist:[]}};return!0}function f(a){var b=a.event,n=a.source,d="undefined"!==typeof n&&null!==n;0===b.data.indexOf("pmrpc.")&&(a=JSON.parse(b.data.substring(6)),"undefined"!==typeof a.method?
(b={data:b.data,source:d?n:b.source,origin:d?"*":b.origin,shouldCheckACL:!d},a=s(a,b),null!==a&&c(b.source,a,b.origin)):p(a))}function s(a,d,e){if("2.0"!==a.jsonrpc)return g(b(-32600,"Invalid request.","The recived JSON is not a valid JSON-RPC 2.0 request."),null,null);var f=a.id;e=n[a.method];if("undefined"!==typeof e)if(!d.shouldCheckACL||h(e.acl,d.origin))try{if(e.isAsync)return k(e.procedure,e.context,a.params,[function(a){c(d.source,g(null,a,f),d.origin)},function(a){c(d.source,g(b(-1,"Application error.",
a.message),null,f),d.origin)},d]),null;var q=k(e.procedure,e.context,a.params,[d]);return"undefined"===typeof f?null:g(null,q,f)}catch(t){return"undefined"===typeof f?null:t.match("^(No such param)")?g(b(-32602,"Invalid params.",t.message),null,f):g(b(-1,"Application error.",t.message),null,f)}else return"undefined"===typeof f?null:g(b(-2,"Application error.","Access denied on server."),null,f);else return"undefined"===typeof f?null:g(b(-32601,"Method not found.","The requestd remote procedure does not exist or is not available."),
null,f)}function p(a){var b=a.id,c=t[b];if("undefined"!==typeof c&&null!==c)if(delete t[b],"undefined"===typeof a.error)c.onSuccess({destination:c.destination,publicProcedureName:c.publicProcedureName,params:c.params,status:"success",returnValue:a.result});else c.onError({destination:c.destination,publicProcedureName:c.publicProcedureName,params:c.params,status:"error",message:a.error.message+" "+a.error.data})}function a(a){if(a.retries&&0>a.retries)throw new Exception("number of retries must be 0 or higher");
var b=[];if("undefined"===typeof a.destination||null===a.destination||"workerParent"===a.destination)b=[{context:null,type:"workerParent"}];else if("publish"===a.destination)b=u().concat(w);else if(a.destination instanceof Array)for(var c=0;c<a.destination.length;c++)"workerParent"===a.destination[c]?b.push({context:null,type:"workerParent"}):"undefined"!==typeof a.destination[c].frames?b.push({context:a.destination[c],type:"window"}):b.push({context:a.destination[c],type:"worker"});else"undefined"!==
typeof a.destination.frames?b.push({context:a.destination,type:"window"}):b.push({context:a.destination,type:"worker"});for(c=0;c<b.length;c++){var n={destination:b[c].context,destinationDomain:"undefined"===typeof a.destinationDomain?["*"]:"string"===typeof a.destinationDomain?[a.destinationDomain]:a.destinationDomain,publicProcedureName:a.publicProcedureName,onSuccess:"undefined"!==typeof a.onSuccess?a.onSuccess:function(){},onError:"undefined"!==typeof a.onError?a.onError:function(){},retries:"undefined"!==
typeof a.retries?a.retries:5,timeout:"undefined"!==typeof a.timeout?a.timeout:500,status:"requestNotSent"};isNotification="undefined"===typeof a.onError&&"undefined"===typeof a.onSuccess;params="undefined"!==typeof a.params?a.params:[];callId=d();t[callId]=n;n.message=isNotification?e(a.publicProcedureName,params):e(a.publicProcedureName,params,callId);r(callId)}}function c(a,b,c){if("undefined"===typeof a||null===a)self.postMessage("pmrpc."+JSON.stringify(b));else{if("undefined"!==typeof a.frames)return a.postMessage("pmrpc."+
JSON.stringify(b),c);a.postMessage("pmrpc."+JSON.stringify(b))}}function r(n){var d=t[n];if("undefined"!==typeof d)if(-1>=d.retries)p(g(b(-4,"Application error.","Destination unavailable."),null,n));else if("requestSent"!==d.status)if(0===d.retries||"available"===d.status){d.status="requestSent";d.retries=-1;t[n]=d;for(var e=0;e<d.destinationDomain.length;e++)c(d.destination,d.message,d.destinationDomain[e],d),self.setTimeout(function(){r(n)},d.timeout)}else d.status="pinging",d.retries-=1,a({destination:d.destination,
publicProcedureName:"receivePingRequest",onSuccess:function(a){!0===a.returnValue&&"undefined"!==typeof t[n]&&(t[n].status="available",r(n))},params:[d.publicProcedureName],retries:0,destinationDomain:d.destinationDomain}),t[n]=d,self.setTimeout(function(){t[n]&&"pinging"===t[n].status&&r(n)},d.timeout/d.retries)}function l(a,b,c,d){"addEventListener"in a?a.addEventListener(b,c,d):a.attachEvent("on"+b,c)}function m(a,b,c){return function(d){a({event:d,source:b,destinationType:c})}}function u(){var a=
[];if("undefined"!==typeof window){a.push({context:window.top,type:"window"});for(var b=0;"undefined"!==typeof a[b];b++)for(var c=a[b],d=0;d<c.context.frames.length;d++)a.push({context:c.context.frames[d],type:"window"})}else a.push({context:this,type:"workerParent"});return a}if("undefined"===typeof JSON||"undefined"===typeof JSON.stringify||"undefined"===typeof JSON.parse)throw"pmrpc requires the JSON library";if("undefined"===typeof this.postMessage&&"undefined"===typeof this.onconnect)throw"pmrpc requires the HTML5 cross-document messaging and worker APIs";
var n={},t={},v={};if("window"in this){var x=m(f,null,"window");l(this,"message",x,!1)}else if("onmessage"in this)x=m(f,this,"worker"),l(this,"message",x,!1);else if("onconnect"in this)l(this,"connect",function(a){var b=m(f,a.ports[0],"sharedWorker");l(a.ports[0],"message",b,!1);a.ports[0].start()},!1);else throw"Pmrpc must be loaded within a browser window or web worker.";var y=this.Worker;this.nonPmrpcWorker=y;var z=this.SharedWorker;this.nonPmrpcSharedWorker=z;var w=[];this.Worker=function(a){a=
new y(a);w.push({context:a,type:"worker"});var b=m(f,a,"worker");l(a,"message",b,!1);return a};this.SharedWorker=function(a,b){var c=new z(a,b);w.push({context:c,type:"sharedWorker"});var d=m(f,c.port,"sharedWorker");l(c.port,"message",d,!1);c.postMessage=function(a,b){return c.port.postMessage(a,b)};c.port.start();return c};q({publicProcedureName:"receivePingRequest",procedure:function(a){return"undefined"!==typeof n[a]}});q({publicProcedureName:"getRegisteredProcedures",procedure:function(){var a=
[],b="undefined"!==typeof this.frames?window.location.protocol+"//"+window.location.host+(""!==window.location.port?":"+window.location.port:""):"",c;for(c in n)c in v||a.push({publicProcedureName:n[c].publicProcedureName,acl:n[c].acl,origin:b});return a}});v={getRegisteredProcedures:null,receivePingRequest:null};return{register:q,unregister:function(a){if(a in v)return!1;delete n[a];return!0},call:a,discover:function(a){var b=null;if("undefined"===typeof a.destination)for(var b=u().concat(w),c=0;c<
b.length;c++)b[c]=b[c].context;else b=a.destination;var d="undefined"===typeof a.originRegex?"(.*)":a.originRegex,n="undefined"===typeof a.nameRegex?"(.*)":a.nameRegex,g=b.length,e=[];pmrpc.call({destination:b,destinationDomain:"*",publicProcedureName:"getRegisteredProcedures",onSuccess:function(b){g--;var c=b.returnValue;b=b.destination;for(var f=0;f<c.length;f++)c[f].origin.match(RegExp(d))&&c[f].publicProcedureName.match(RegExp(n))&&e.push({publicProcedureName:c[f].publicProcedureName,destination:b,
procedureACL:c[f].acl,destinationOrigin:c[f].origin});0===g&&a.callback(e)},onError:function(b){g--;0===g&&a.callback(e)}})}}}();
WebApp.Controller=function(d){function h(a){}function k(a){if(0!=a.length)for(var b=0;b<a.length;b++)g(a[b].state,d.state.applications[b].state)&&(l.debug("WebApp.Controller: "+e(a,b,"state")+", notifying view"),f("model.state.applications."+b+".state")),g(a[b].appMsg,d.state.applications[b].appMsg)&&(l.debug("WebApp.Controller: "+e(a,b,"appMsg")+", notifying view"),f("model.state.applications."+b+".appMsg"))}function k(a){if(0!=a.length)for(var b=0;b<a.length;b++)g(a[b].state,d.state.applications[b].state)&&
(l.debug("WebApp.Controller: "+e(a,b,"state")+", notifying view"),f("model.state.applications."+b+".state")),g(a[b].appMsg,d.state.applications[b].appMsg)&&(l.debug("WebApp.Controller: "+e(a,b,"appMsg")+", notifying view"),f("model.state.applications."+b+".appMsg"))}function e(a,b,c){var g=a[b][c];a=d.state.applications[b][c];g=g instanceof Object?JSON.stringify(g).substring(0,100):g;a=a instanceof Object?JSON.stringify(a).substring(0,100):a;return"model.state.applications."+b+"."+c+" changed from "+
g+" to "+a}function b(a,b,c){var g=a[b][c];a=d.state.players[b][c];g=g instanceof Object?JSON.stringify(g).substring(0,100):g;a=a instanceof Object?JSON.stringify(a).substring(0,100):a;return"model.state.players."+b+"."+c+" changed from "+g+" to "+a}function g(a,b){return!q(a,b)&&!!(null!==a&&void 0!==a||null!==b&&void 0!==b)}function q(a,b){if(a instanceof Function)return b instanceof Function?a.toString()===b.toString():!1;if(null===a||void 0===a||null===b||void 0===b)return a===b;if(a===b||a.valueOf()===
b.valueOf())return!0;if(a instanceof Date||b instanceof Date||!(a instanceof Object)||!(b instanceof Object))return!1;var c=Object.keys(a);return Object.keys(b).every(function(a){return-1!==c.indexOf(a)})?c.every(function(c){return q(a[c],b[c])}):!1}function f(a){l.debug("WebApp.Controller: notifyView('"+a+"')");r.emit(a,a)}function s(b,c,d){void 0==d&&(d=p);l.debug("WebApp.Controller: sending pmrpc call to master controller - "+b+"("+JSON.stringify(c)+")");pmrpc.call({destination:window.top,publicProcedureName:b,
params:[c],timeout:3E3,onSuccess:d,onError:a})}function p(a){l.trace("WebApp.Controller: pmrpc message ("+a.publicProcedureName+") delivery confirmed");void 0!=a.returnValue&&(l.debug("WebApp.Controller: object returned from pmrpc message send:  "+JSON.stringify(a.returnValue)),l.warn("WebApp.Controller: this return object is ignored"))}function a(a){l.error("WebApp.Controller: pmrpc message "+a.publicProcedureName+"("+JSON.stringify(a.params)+") send FAILED");l.error("WebApp.Controller: error status info returned: "+
a.message)}var c=this;d=d?d:new WebApp.Model;var r=new WebApp.EventEmitter({wildcard:!0}),l=new NAF.utils.Log,m,u=[];m=["model.channels","model.state.players","model.state.applications"];l.enable();0===NAF.conf.debug?l.setLevel.error():1===NAF.conf.debug?l.setLevel.warn():2===NAF.conf.debug?l.setLevel.debug():3===NAF.conf.debug?l.setLevel.trace():4===NAF.conf.debug?l.setLevel.info():l.disable();this.on=function(a,b){r.on(a,b)};this.off=function(a,b){r.off(a,b)};this.init=function(){s("init",m,h)};
this["do"]=function(a,b){if(a.match(/^model\.state\.applications\.\d+\.appMsg$/)&&b instanceof Object)if(void 0==b.sourceId){var c;c=!1;for(var g,e=0;e<d.state.applications.length;e++)if(window.name===d.state.applications[e].windowId){l.trace("WebApp.Controller: detected that I'm application #"+e);c=!0;g=e;break}c||(l.error("WebApp.Controller: could not identify myself in application table, no entry with iframe id "+window.name),g=-1);c=g;-1<c?(l.debug("using index "+c+" in app array table (length "+
d.state.applications.length+")"),b.sourceId=d.state.applications[c].id,l.debug("WebApp.Controller: supplying appMsg sourceId - "+b.sourceId+" for app #"+c)):b.sourceId="unknown"}else l.debug("WebApp.Controller: using webapp-supplied appMsg sourceId - "+b.sourceId);s("do",[a,b])};this.load=function(a,b){s("load",[a,b])};this.registerPMRPC=function(){pmrpc.register({publicProcedureName:"update-model",procedure:function(a){try{l.trace("WebApp.Controller: pmrpc message received - "+a),c.UpdateModel(a)}catch(b){l.error("error processing model update - "+
b),l.error(b.stack)}}})};this.UpdateModel=function(a){if("key"===a[0])l.debug("WebApp.Controller: key input received - "+a[1]),d.state.key=a[1],f("model.state.key");else if("application"==a[0]){var c=d.state.applications[a[1]].inFocus;d.state.applications[a[1]].inFocus="true"==a[2];if(d.state.applications[a[1]].inFocus)if(c){for(var c=d.state.applications,e=parseInt(a[1]),q=0;q<c.length;q++)if(q!==e){var h=d.state.applications[q].inFocus;d.state.applications[q].inFocus=!1;h&&f("model.state.applications."+
q)}l.debug("WebApp.Controller: focus set on app "+a[1]);f("model.state.applications."+a[1])}else l.trace("app "+a[1]+" already had focus");else l.trace("WebApp.Controller: focus unset on app "+a[1])}else if("channels"==a[0])l.debug("WebApp.Controller: channel array update received"),d.channels=a[1],u.push("model.channels");else if("applications"==a[0])l.debug("WebApp.Controller: application array update received"),c=d.state.applications,d.state.applications=a[1],k(c),u.push("model.state.applications");
else if("players"==a[0]){if(l.debug("WebApp.Controller: player array update received"),c=d.state.players,d.state.players=a[1],u.push("model.state.players"),0!=c.length)for(a=0;a<c.length;a++)g(c[a].currentProgram,d.state.players[a].currentProgram)&&(l.debug("WebApp.Controller: "+b(c,a,"currentProgram")+", notifying view"),f("model.state.players."+a+".currentProgram")),g(c[a].isBlocked,d.state.players[a].isBlocked)&&(l.debug("WebApp.Controller: "+b(c,a,"isBlocked")+", notifying view"),f("model.state.players."+
a+".isBlocked")),g(c[a].playRate,d.state.players[a].playRate)&&(l.debug("WebApp.Controller: "+b(c,a,"playRate")+", notifying view"),f("model.state.players."+a+".playRate")),g(c[a].source,d.state.players[a].source)&&(l.debug("WebApp.Controller: "+b(c,a,"source")+", notifying view"),f("model.state.players."+a+".source")),g(c[a].status,d.state.players[a].status)&&(l.debug("WebApp.Controller: "+b(c,a,"status")+", notifying view"),f("model.state.players."+a+".status")),g(c[a].position,d.state.players[a].position)&&
(l.debug("WebApp.Controller: "+b(c,a,"position")+", notifying view"),f("model.state.players."+a+".position")),g(c[a].availAudioLangs,d.state.players[a].availAudioLangs)&&(l.debug("WebApp.Controller: "+b(c,a,"availAudioLangs")+", notifying view"),f("model.state.players."+a+".availAudioLangs")),g(c[a].audioLang,d.state.players[a].audioLang)&&(l.debug("WebApp.Controller: "+b(c,a,"audioLang")+", notifying view"),f("model.state.players."+a+".audioLang")),g(c[a].availSubtitleLangs,d.state.players[a].availSubtitleLangs)&&
(l.debug("WebApp.Controller: "+b(c,a,"availSubtitleLangs")+", notifying view"),f("model.state.players."+a+".availSubtitleLangs")),g(c[a].subtitleLang.enable,d.state.players[a].subtitleLang.enable)&&(l.debug("WebApp.Controller: model.state.players."+a+".subtitleLang.enable changed from "+c[a].subtitleLang.enable+" to "+d.state.players[a].subtitleLang.enable+", notifying view"),f("model.state.players."+a+".subtitleLang.enable")),g(c[a].subtitleLang,d.state.players[a].subtitleLang)&&(l.debug("WebApp.Controller: "+
b(c,a,"subtitleLang")+", notifying view"),f("model.state.players."+a+".subtitleLang")),g(c[a].teletextLang,d.state.players[a].teletextLang)&&(l.debug("WebApp.Controller: "+b(c,a,"teletextLang")+", notifying view"),f("model.state.players."+a+".teletextLang")),g(c[a].window,d.state.players[a].window)&&(l.debug("WebApp.Controller: "+b(c,a,"window")+", notifying view"),f("model.state.players."+a+".window"))}else"channelTuned"==a[0]&&(l.debug("WebApp.Controller: channel tuned update received - player "+
a[1]+", channel "+a[2]),c=a[1],void 0!=a[2]&&(d.state.players[c].source.idx=a[2],f("model.state.players."+c+".source","model.state.players."+c+".source")));if(!d.initialized){if(u.length>=m.length)for(a=0;a<m.length;a++)if(u.indexOf(m[a]))return;d.initialized=!0;l.debug("WebApp.Controller: WebApp.model is initialized");f("model.initialized")}}};
(function(d,h){function k(b,d,e,f){if(!e)return[];var h=[],p,a,c,r;c=d.length;r=d[f];var l=d[f+1];if(f===c&&e._listeners){if("function"===typeof e._listeners)b&&b.push(e._listeners);else for(d=0,f=e._listeners.length;d<f;d++)b&&b.push(e._listeners[d]);return[e]}if("*"===r||"**"===r||e[r]){if("*"===r){for(p in e)"_listeners"!==p&&e.hasOwnProperty(p)&&(h=h.concat(k(b,d,e[p],f+1)));return h}if("**"===r){(r=f+1===c||f+2===c&&"*"===l)&&e._listeners&&(h=h.concat(k(b,d,e,c)));for(p in e)"_listeners"!==p&&
e.hasOwnProperty(p)&&("*"===p||"**"===p?(e[p]._listeners&&!r&&(h=h.concat(k(b,d,e[p],c))),h=h.concat(k(b,d,e[p],f))):h=p===l?h.concat(k(b,d,e[p],f+2)):h.concat(k(b,d,e[p],f)));return h}h=h.concat(k(b,d,e[r],f+1))}(a=e["*"])&&k(b,d,a,f+1);if(e=e["**"])if(f<c)for(p in e._listeners&&k(b,d,e,c),e)"_listeners"!==p&&e.hasOwnProperty(p)&&(p===l?k(b,d,e[p],f+2):p===r?k(b,d,e[p],f+1):(c={},c[p]=e[p],k(b,d,{"**":c},f+1)));else e._listeners?k(b,d,e,c):e["*"]&&e["*"]._listeners&&k(b,d,e["*"],c);return h}var e=
Array.isArray?Array.isArray:function(b){return"[object Array]"===Object.prototype.toString.call(b)};WebApp.EventEmitter=function(b){this._events={};b&&(b.delimiter&&(this.delimiter=b.delimiter),b.wildcard&&(this.wildcard=b.wildcard),this.wildcard&&(this.listenerTree={}))};WebApp.EventEmitter.prototype.delimiter=".";WebApp.EventEmitter.prototype.setMaxListeners=function(b){this._events||(this._events={});this._events.maxListeners=b};WebApp.EventEmitter.prototype.event="";WebApp.EventEmitter.prototype.once=
function(b,d){this.many(b,1,d);return this};WebApp.EventEmitter.prototype.many=function(b,d,e){function f(){0===--d&&k.off(b,f);e.apply(this,arguments)}var k=this;if("function"!==typeof e)throw Error("many only accepts instances of Function");f._origin=e;this.on(b,f);return k};WebApp.EventEmitter.prototype.emit=function(){this._events||(this._events={});var b=arguments[0];if("newListener"===b&&!this._events.newListener)return!1;if(this._all){for(var d=arguments.length,e=Array(d-1),f=1;f<d;f++)e[f-
1]=arguments[f];f=0;for(d=this._all.length;f<d;f++)this.event=b,this._all[f].apply(this,e)}if("error"===b&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error)){if(arguments[1]instanceof Error)throw arguments[1];throw Error("Uncaught, unspecified 'error' event.");}var h;this.wildcard?(h=[],d="string"===typeof b?b.split(this.delimiter):b.slice(),k.call(this,h,d,this.listenerTree,0)):h=this._events[b];if("function"===typeof h){this.event=b;if(1===arguments.length)h.call(this);else if(1<
arguments.length)switch(arguments.length){case 2:h.call(this,arguments[1]);break;case 3:h.call(this,arguments[1],arguments[2]);break;default:d=arguments.length;e=Array(d-1);for(f=1;f<d;f++)e[f-1]=arguments[f];h.apply(this,e)}return!0}if(h){d=arguments.length;e=Array(d-1);for(f=1;f<d;f++)e[f-1]=arguments[f];h=h.slice();f=0;for(d=h.length;f<d;f++)this.event=b,h[f].apply(this,e);return 0<h.length||this._all}return this._all};WebApp.EventEmitter.prototype.on=function(b,d){if("function"===typeof b)return this.onAny(b),
this;if("function"!==typeof d)throw Error("on only accepts instances of Function");this._events||(this._events={});this.emit("newListener",b,d);if(this.wildcard){a:{for(var h=b,h="string"===typeof h?h.split(this.delimiter):h.slice(),f=0,k=h.length;f+1<k;f++)if("**"===h[f]&&"**"===h[f+1])break a;f=this.listenerTree;for(k=h.shift();k;){f[k]||(f[k]={});f=f[k];if(0===h.length){f._listeners?"function"===typeof f._listeners?f._listeners=[f._listeners,d]:e(f._listeners)&&(f._listeners.push(d),f._listeners.warned||
(h=10,"undefined"!==typeof this._events.maxListeners&&(h=this._events.maxListeners),0<h&&f._listeners.length>h&&(f._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",f._listeners.length),console.trace()))):f._listeners=d;break a}k=h.shift()}}return this}this._events[b]?"function"===typeof this._events[b]?this._events[b]=[this._events[b],d]:e(this._events[b])&&(this._events[b].push(d),
this._events[b].warned||(h=10,"undefined"!==typeof this._events.maxListeners&&(h=this._events.maxListeners),0<h&&this._events[b].length>h&&(this._events[b].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[b].length),console.trace()))):this._events[b]=d;return this};WebApp.EventEmitter.prototype.onAny=function(b){this._all||(this._all=[]);if("function"!==typeof b)throw Error("onAny only accepts instances of Function");
this._all.push(b);return this};WebApp.EventEmitter.prototype.addListener=WebApp.EventEmitter.prototype.on;WebApp.EventEmitter.prototype.off=function(b,d){if("function"!==typeof d)throw Error("removeListener only takes instances of Function");var h,f=[];if(this.wildcard)h="string"===typeof b?b.split(this.delimiter):b.slice(),f=k.call(this,null,h,this.listenerTree,0);else{if(!this._events[b])return this;h=this._events[b];f.push({_listeners:h})}for(var s=0;s<f.length;s++){var p=f[s];h=p._listeners;if(e(h)){for(var a=
-1,c=0,r=h.length;c<r;c++)if(h[c]===d||h[c].listener&&h[c].listener===d||h[c]._origin&&h[c]._origin===d){a=c;break}if(0>a)break;this.wildcard?p._listeners.splice(a,1):this._events[b].splice(a,1);0===h.length&&(this.wildcard?delete p._listeners:delete this._events[b])}else if(h===d||h.listener&&h.listener===d||h._origin&&h._origin===d)this.wildcard?delete p._listeners:delete this._events[b]}return this};WebApp.EventEmitter.prototype.offAny=function(b){var d=0,e=0,f;if(b&&this._all&&0<this._all.length)for(f=
this._all,d=0,e=f.length;d<e;d++){if(b===f[d]){f.splice(d,1);break}}else this._all=[];return this};WebApp.EventEmitter.prototype.removeListener=WebApp.EventEmitter.prototype.off;WebApp.EventEmitter.prototype.removeAllListeners=function(b){if(0===arguments.length)return this._events&&(this._events={}),this;if(this.wildcard)for(var d="string"===typeof b?b.split(this.delimiter):b.slice(),d=k.call(this,null,d,this.listenerTree,0),e=0;e<d.length;e++)d[e]._listeners=null;else{if(!this._events[b])return this;
this._events[b]=null}return this};WebApp.EventEmitter.prototype.listeners=function(b){if(this.wildcard){var d=[];b="string"===typeof b?b.split(this.delimiter):b.slice();k.call(this,d,b,this.listenerTree,0);return d}this._events||(this._events={});this._events[b]||(this._events[b]=[]);e(this._events[b])||(this._events[b]=[this._events[b]]);return this._events[b]};WebApp.EventEmitter.prototype.listenersAny=function(){return this._all?this._all:[]};"function"===typeof define&&define.amd?define(function(){return WebApp.EventEmitter}):
d.EventEmitter2=WebApp.EventEmitter})("undefined"!==typeof process&&"undefined"!==typeof process.title&&"undefined"!==typeof exports?exports:"undefined"!==typeof window?window:null);
WebApp.Model=function(){ComponentLang=function(d,h){this.code=d;this.type=h};Player=function(d,h,k,e,b,g,q,f){this.currentChannel=this.source=d;this.playRate=h;this.position=k;this.window=e;this.zIndex=b;this.duration=g;this.status=null;this.availAudioLangs=[];this.availSubtitleLangs=[];this.audioLang=new ComponentLang(q,f);this.subtitleLang=new ComponentLang(q,f);this.teletextLang=new ComponentLang(q,f);this.restricted=this.mapLoc=null;this.isBlocked=!1};State=function(){this.applications=[];this.key=
null;this.players=[]};AppMessage=function(d,h,k){this.id=d;this.sourceId=h;this.method=k;this.message={}};Channel=function(d,h,k,e,b,g,q,f){this.idx=d;this.id=h;this.locator=k;this.lcn=e;this.name=b;this.pictures=g;this.viewable=q;this.isFav=!1;this.plcn=0};Application=function(d,h,k,e,b,g,q,f,s,p,a,c){this.id=d;this.name=h;this.shortSynopsis=k;this.isAdult=e;this.isViewable=b;this.isEntitled=g;this.products=[];this.pictures=[];this.url=q;this.inFocus=f;this.windowId=s;this.viewState=p;this.state=
a;this.type=c;this.appMsg=new AppMessage;this.reservedKeys=[];this.appKeys=[];this.modelSets=[];this.media={assets:[]}};MediaAsset=function(d,h,k,e,b,g,q,f,s,p,a,c,r){this.id=d;this.name=h;this.URL=k;this.picture=e;this.type=b;this.mimeType=g;this.encoding=q;this.description=f;this.genre=s;this.date=date;this.size=a;this.duration=c;this.ageRating=r};this.State=State;this.Application=Application;this.Player=Player;this.channels=[];this.state=new State;this.Channel=Channel;this.keymap=new function(){this.VK_EXIT=
3;this.VK_BACK_SPACE=8;this.VK_ENTER=this.VK_OK=13;this.VK_KEYBOARD=16;this.VK_ACCEPT=30;this.VK_SPACE=32;this.VK_PAGE_UP=33;this.VK_PAGE_DOWN=34;this.VK_HOME=36;this.VK_LEFT=37;this.VK_UP=38;this.VK_RIGHT=39;this.VK_DOWN=40;this.VK_0=48;this.VK_1=49;this.VK_2=50;this.VK_3=51;this.VK_4=52;this.VK_5=53;this.VK_6=54;this.VK_7=55;this.VK_8=56;this.VK_9=57;this.VK_A=65;this.VK_B=66;this.VK_C=67;this.VK_D=68;this.VK_E=69;this.VK_F=70;this.VK_G=71;this.VK_H=72;this.VK_I=73;this.VK_J=74;this.VK_K=75;this.VK_L=
76;this.VK_M=77;this.VK_N=78;this.VK_O=79;this.VK_P=80;this.VK_Q=81;this.VK_R=82;this.VK_S=83;this.VK_T=84;this.VK_U=85;this.VK_V=86;this.VK_W=87;this.VK_X=88;this.VK_Y=89;this.VK_Z=90;this.VK_RED=403;this.VK_GREEN=404;this.VK_BLUE=406;this.VK_YELLOW=405;this.VK_DELETE=127;this.VK_HELP=156;this.VK_POWER=409;this.VK_CHANNEL_UP=427;this.VK_CHANNEL_DOWN=428;this.VK_VOLUME_UP=447;this.VK_VOLUME_DOWN=448;this.VK_MUTE=449;this.VK_INFO=457;this.VK_GUIDE=458;this.VK_BACK=461;this.VK_MENU=462;this.VK_PAUSE=
19;this.VK_REW=412;this.VK_STOP=413;this.VK_PLAY=415;this.VK_REC=416;this.VK_FF=417;this.VK_REW_SKIP=424;this.VK_FWD_SKIP=425;this.VK_FAV=433;this.VK_TELETEXT=459;this.VK_SUBTITLE=460}};
